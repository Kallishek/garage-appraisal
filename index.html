<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Garage Appraisal Pro</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Arial; padding: 20px; background:#f2f2f7; }
    input, textarea { width:100%; padding:12px; margin:8px 0; border-radius:10px; border:1px solid #ccc; font-size:16px; }
    button { padding:12px 16px; margin:8px 6px 8px 0; border:none; border-radius:10px; background:black; color:white; font-size:15px; cursor:pointer; }
    h1 { margin-bottom:10px; }
    h2 { margin-top:25px; }
    .card { background:white; padding:20px; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
    .total { font-size:20px; font-weight:bold; margin-top:10px; }
    .section { margin-top:25px; }
    canvas { border:1px solid #ccc; border-radius:10px; width:100%; height:120px; touch-action:none; }
    @media print {
      button { display:none; }
      body { background:white; }
      .card { box-shadow:none; }
    }
  </style>
</head>
<body>

<div class="card">
  <h1>Vehicle Appraisal Pro</h1>

  <div class="section">
    <h2>Vehicle Info</h2>
    <input id="date" type="date">
    <input id="brand" placeholder="Brand">
    <input id="model" placeholder="Model">
    <input id="registration" placeholder="Registration">
    <input id="colour" placeholder="Colour">
    <input id="mileage" placeholder="Mileage">
    <input id="source" placeholder="Source (P/X, Buy-In, etc)">
    <input id="keys" type="number" placeholder="Number of Keys">
    <input id="tracker" placeholder="Tracker Number">
  </div>

  <div class="section">
    <h2>Damage Items (£)</h2>
    <div id="damageContainer"></div>
    <div class="total">Total: £<span id="total">0.00</span></div>
  </div>

  <div class="section">
    <h2>Additional Notes</h2>
    <textarea id="notes" placeholder="Extra notes"></textarea>
  </div>

  <div class="section">
    <h2>Digital Signature</h2>
    <canvas id="signaturePad"></canvas>
    <button type="button" onclick="clearSignature()">Clear Signature</button>
  </div>

  <div class="section">
    <h2>Appraised By</h2>
    <input id="appraiser" placeholder="Name">
  </div>

  <button onclick="quickEmail()">Quick Email</button>
  <button onclick="generatePDF()">Generate Signed PDF</button>
</div>

<script>

window.onload = function() {

  const today = new Date().toISOString().split('T')[0];
  document.getElementById('date').value = today;

  const container = document.getElementById('damageContainer');
  for (let i = 1; i <= 6; i++) {
    container.innerHTML += `
      <input id="damage${i}" placeholder="Item ${i} description">
      <input id="cost${i}" type="number" placeholder="Cost ${i}" oninput="calculateTotal()">
    `;
  }

  const canvas = document.getElementById('signaturePad');
  const ctx = canvas.getContext('2d');
  let drawing = false;

  canvas.width = canvas.offsetWidth;
  canvas.height = 120;

  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mouseup', endDraw);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('touchstart', startDraw);
  canvas.addEventListener('touchend', endDraw);
  canvas.addEventListener('touchmove', draw);

  function startDraw(e) { drawing = true; draw(e); }
  function endDraw() { drawing = false; ctx.beginPath(); }

  function draw(e) {
    if (!drawing) return;
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
  }

  window.clearSignature = function() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  window.calculateTotal = function() {
    let total = 0;
    for (let i = 1; i <= 6; i++) {
      total += parseFloat(document.getElementById('cost' + i).value) || 0;
    }
    document.getElementById('total').innerText = total.toFixed(2);
  }

  function collectData() {
    const data = {
      date: document.getElementById('date').value,
      brand: document.getElementById('brand').value,
      model: document.getElementById('model').value,
      reg: document.getElementById('registration').value,
      colour: document.getElementById('colour').value,
      mileage: document.getElementById('mileage').value,
      source: document.getElementById('source').value,
      keys: document.getElementById('keys').value,
      tracker: document.getElementById('tracker').value,
      notes: document.getElementById('notes').value,
      appraiser: document.getElementById('appraiser').value,
      total: document.getElementById('total').innerText,
      signature: canvas.toDataURL()
    };

    let damages = [];
    for (let i = 1; i <= 6; i++) {
      const d = document.getElementById('damage' + i).value;
      const c = document.getElementById('cost' + i).value;
      if (d || c) damages.push(${d} - £${c || 0});
    }
    data.damages = damages;
    return data;
  }

  window.quickEmail = function() {
    const d = collectData();
    const subject = Appraisal Report - ${d.brand} ${d.model} (${d.reg});

    const body =
      Date: ${d.date}%0D%0A +
      Brand: ${d.brand}%0D%0A +
      Model: ${d.model}%0D%0A +
      Registration: ${d.reg}%0D%0A +
      Colour: ${d.colour}%0D%0A +
      Mileage: ${d.mileage}%0D%0A +
      Source: ${d.source}%0D%0A +
      Keys: ${d.keys}%0D%0A +
      Tracker: ${d.tracker}%0D%0A%0D%0A +
      DAMAGE:%0D%0A +
      d.damages.join('%0D%0A') + %0D%0A%0D%0A +
      TOTAL: £${d.total}%0D%0A%0D%0A +
      Appraised by: ${d.appraiser};

    window.location.href = mailto:?subject=${subject}&body=${body};
  }

  window.generatePDF = function() {
    const d = collectData();
    const win = window.open('', '_blank');

    win.document.write(`
      <html>
      <head>
        <title>Vehicle Appraisal Report</title>
        <style>
          body { font-family: Arial; padding:40px; }
          h1 { margin-bottom:20px; }
          .section { margin-top:20px; }
          .total { font-size:18px; font-weight:bold; margin-top:15px; }
          img { margin-top:10px; }
        </style>
      </head>
      <body>
        <h1>Vehicle Appraisal Report</h1>
        <div class="section">
          <strong>Date:</strong> ${d.date}<br>
          <strong>Brand:</strong> ${d.brand}<br>
          <strong>Model:</strong> ${d.model}<br>
          <strong>Registration:</strong> ${d.reg}<br>
          <strong>Colour:</strong> ${d.colour}<br>
          <strong>Mileage:</strong> ${d.mileage}<br>
          <strong>Source:</strong> ${d.source}<br>
          <strong>Keys:</strong> ${d.keys}<br>
          <strong>Tracker:</strong> ${d.tracker}
        </div>
        <div class="section">
          <h3>Damage Breakdown</h3>
          ${d.damages.map(x => <div>${x}</div>).join('')}
          <div class="total">Total: £${d.total}</div>
        </div>
        <div class="section">
          <h3>Notes</h3>
          <div>${d.notes}</div>
        </div>
        <div class="section">
          <h3>Signature</h3>
          <img src="${d.signature}" width="250" />
          <div>Signed by: ${d.appraiser}</div>
        </div>
        <script>window.print()<\/script>
      </body>
      </html>
    `);
  }

}

</script>

</body>
</html>
