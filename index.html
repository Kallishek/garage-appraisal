<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Garage Appraisal Pro</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, Arial; padding: 20px; background:#f2f2f7; }
    input, textarea { width:100%; padding:12px; margin:8px 0; border-radius:10px; border:1px solid #ccc; font-size:16px; }
    button { padding:12px 16px; margin:8px 6px 8px 0; border:none; border-radius:10px; background:black; color:white; font-size:15px; cursor:pointer; }
    h1 { margin-bottom:10px; }
    h2 { margin-top:25px; }
    .card { background:white; padding:20px; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
    .total { font-size:20px; font-weight:bold; margin-top:10px; }
    .section { margin-top:25px; }
    canvas { border:1px solid #ccc; border-radius:10px; width:100%; height:120px; touch-action:none; }
    @media print {
      button { display:none; }
      body { background:white; }
      .card { box-shadow:none; }
    }
  </style>
</head>
<body>

<div class="card">
  <h1>Vehicle Appraisal Pro</h1>

  <div class="section">
    <h2>Vehicle Info</h2>
    <input id="date" type="date">
    <input id="brand" placeholder="Brand">
    <input id="model" placeholder="Model">
    <input id="registration" placeholder="Registration">
    <input id="colour" placeholder="Colour">
    <input id="mileage" placeholder="Mileage">
    <input id="source" placeholder="Source (P/X, Buy-In, etc)">
    <input id="keys" type="number" placeholder="Number of Keys">
    <input id="tracker" placeholder="Tracker Number">
  </div>

  <div class="section">
  <h2>Body Damage Map</h2>

  <div style="margin-bottom:10px;">
    <button type="button" onclick="damageMapSet('D')">Dent (D)</button>
    <button type="button" onclick="damageMapSet('C')">Chip (C)</button>
    <button type="button" onclick="damageMapSet('S')">Scratch (S)</button>
    <button type="button" onclick="damageMapClear()">Clear Marks</button>
  </div>

  <div id="damageMapContainer" 
     style="position:relative; width:100%; max-width:400px;"
     onclick="damageMapPlace(event)">

  <img src="Unknown.jpg" 
       style="width:100%; display:block;">

</div> 
  <div class="section">
    <h2>Damage Items (£)</h2>
    <div id="damageContainer"></div>
    <div class="total">Total: £<span id="total">0.00</span></div>
  </div>

  <div class="section">
    <h2>Additional Notes</h2>
    <textarea id="notes" placeholder="Extra notes"></textarea>
  </div>

  <div class="section">
    <h2>Digital Signature</h2>
    <canvas id="signaturePad"></canvas>
    <button type="button" onclick="clearSignature()">Clear Signature</button>
  </div>

  <div class="section">
    <h2>Appraised By</h2>
    <input id="appraiser" placeholder="Name">
  </div>

  <button onclick="sendEmail()">Send Email Report</button>
  <button onclick="printReport()">Print Report</button>
  <button onclick="saveAppraisal()">Save Appraisal</button>
  <button onclick="document.getElementById('loadFile').click()">Load Appraisal</button>
  <input type="file" id="loadFile" accept=".json" style="display:none" onchange="loadAppraisal(event)">
  </div>

<script>

// Auto set today's date
const today = new Date().toISOString().split('T')[0];
document.getElementById('date').value = today;

// Create 6 damage rows
const container = document.getElementById('damageContainer');
for (let i = 1; i <= 6; i++) {
  container.innerHTML += `
    <input id="damage${i}" placeholder="Item ${i} description">
    <input id="cost${i}" type="number" placeholder="Cost ${i}" oninput="calculateTotal()">
  `;
}

function calculateTotal() {
  let total = 0;
  for (let i = 1; i <= 6; i++) {
    total += parseFloat(document.getElementById('cost' + i).value) || 0;
  }
  document.getElementById('total').innerText = total.toFixed(2);
}

function resetForm() {
  document.querySelectorAll('input, textarea').forEach(el => el.value = '');
  document.getElementById('date').value = today;
  document.getElementById('total').innerText = '0.00';
  clearSignature();
}

// -------- Signature Pad --------
const canvas = document.getElementById('signaturePad');
const ctx = canvas.getContext('2d');
let drawing = false;

canvas.width = canvas.offsetWidth;
canvas.height = 120;

function startDraw(e) {
  drawing = true;
  draw(e);
}

function endDraw() {
  drawing = false;
  ctx.beginPath();
}

function draw(e) {
  if (!drawing) return;
  e.preventDefault();

  const rect = canvas.getBoundingClientRect();
  const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

  ctx.lineWidth = 2;
  ctx.lineCap = 'round';
  ctx.lineTo(x, y);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x, y);
}

canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('touchstart', startDraw);
canvas.addEventListener('touchend', endDraw);
canvas.addEventListener('touchmove', draw);

function clearSignature() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

// -------- Email --------
function sendEmail() {
  const date = document.getElementById('date').value;
  const brand = document.getElementById('brand').value;
  const model = document.getElementById('model').value;
  const reg = document.getElementById('registration').value;
  const colour = document.getElementById('colour').value;
  const mileage = document.getElementById('mileage').value;
  const source = document.getElementById('source').value;
  const keys = document.getElementById('keys').value;
  const tracker = document.getElementById('tracker').value;
  const notes = document.getElementById('notes').value;
  const appraiser = document.getElementById('appraiser').value;
  const total = document.getElementById('total').innerText;

  let damageSection = "";
  for (let i = 1; i <= 6; i++) {
    const d = document.getElementById('damage' + i).value;
    const c = document.getElementById('cost' + i).value;
    if (d || c) {
      damageSection += d + " - £" + (c || 0) + "%0D%0A";
    }
  }

  const subject = "Appraisal Report - " + brand + " " + model + " (" + reg + ")";

  const body =
    "VEHICLE INFORMATION" + "%0D%0A" +
    "Date: " + date + "%0D%0A" +
    "Brand: " + brand + "%0D%0A" +
    "Model: " + model + "%0D%0A" +
    "Registration: " + reg + "%0D%0A" +
    "Colour: " + colour + "%0D%0A" +
    "Mileage: " + mileage + "%0D%0A" +
    "Source: " + source + "%0D%0A" +
    "Keys: " + keys + "%0D%0A" +
    "Tracker: " + tracker + "%0D%0A%0D%0A" +
    "DAMAGE BREAKDOWN" + "%0D%0A" +
    damageSection + "%0D%0A" +
    "TOTAL ESTIMATED COST: £" + total + "%0D%0A%0D%0A" +
    "NOTES:" + "%0D%0A" + notes + "%0D%0A%0D%0A" +
    "Signed by: " + appraiser;

  window.location.href = "mailto:?subject=" + subject + "&body=" + body;

  setTimeout(resetForm, 500);
}

function printReport() {
  window.print();
}
// ===== SAFE BODY DAMAGE MAP SYSTEM =====

let damageMapCurrent = 'D';

function damageMapSet(type) {
  damageMapCurrent = type;
}

function damageMapPlace(e) {
  try {
    const container = document.getElementById('damageMapContainer');
    const rect = container.getBoundingClientRect();

    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const mark = document.createElement('div');
    mark.innerText = damageMapCurrent;
    mark.style.position = 'absolute';
    mark.style.left = x + 'px';
    mark.style.top = y + 'px';
    mark.style.transform = 'translate(-50%, -50%)';
    mark.style.background = 'red';
    mark.style.color = 'white';
    mark.style.borderRadius = '50%';
    mark.style.width = '22px';
    mark.style.height = '22px';
    mark.style.display = 'flex';
    mark.style.alignItems = 'center';
    mark.style.justifyContent = 'center';
    mark.style.fontSize = '12px';
    mark.style.fontWeight = 'bold';

    container.appendChild(mark);
  } catch (err) {
    console.log("Damage map error:", err);
  }
}

function damageMapClear() {
  const container = document.getElementById('damageMapContainer');
  container.innerHTML = '';
}
// ===== SAVE / LOAD SYSTEM =====

function saveAppraisal() {
  try {
    const data = {};

    // Vehicle info
    data.date = document.getElementById('date').value;
    data.brand = document.getElementById('brand').value;
    data.model = document.getElementById('model').value;
    data.registration = document.getElementById('registration').value;
    data.colour = document.getElementById('colour').value;
    data.mileage = document.getElementById('mileage').value;
    data.source = document.getElementById('source').value;
    data.keys = document.getElementById('keys').value;
    data.tracker = document.getElementById('tracker').value;
    data.notes = document.getElementById('notes').value;
    data.appraiser = document.getElementById('appraiser').value;
    data.total = document.getElementById('total').innerText;

    // Damage items
    data.damageItems = [];
    for (let i = 1; i <= 6; i++) {
      data.damageItems.push({
        desc: document.getElementById('damage' + i).value,
        cost: document.getElementById('cost' + i).value
      });
    }

    // Signature
    data.signature = canvas.toDataURL();

    // Map marks
    const marks = [];
    const container = document.getElementById('damageMapContainer');
    container.querySelectorAll('div').forEach(mark => {
      marks.push({
        text: mark.innerText,
        left: mark.style.left,
        top: mark.style.top
      });
    });
    data.mapMarks = marks;

    const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);

    const fileName = (data.registration || "appraisal") + ".json";
    a.download = fileName;
    a.click();

  } catch (err) {
    console.log("Save error:", err);
  }
}

function loadAppraisal(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const data = JSON.parse(e.target.result);

    // Vehicle info
    document.getElementById('date').value = data.date || '';
    document.getElementById('brand').value = data.brand || '';
    document.getElementById('model').value = data.model || '';
    document.getElementById('registration').value = data.registration || '';
    document.getElementById('colour').value = data.colour || '';
    document.getElementById('mileage').value = data.mileage || '';
    document.getElementById('source').value = data.source || '';
    document.getElementById('keys').value = data.keys || '';
    document.getElementById('tracker').value = data.tracker || '';
    document.getElementById('notes').value = data.notes || '';
    document.getElementById('appraiser').value = data.appraiser || '';
    document.getElementById('total').innerText = data.total || '0.00';

    // Damage items
    if (data.damageItems) {
      data.damageItems.forEach((item, index) => {
        document.getElementById('damage' + (index + 1)).value = item.desc;
        document.getElementById('cost' + (index + 1)).value = item.cost;
      });
    }

    // Restore signature
    if (data.signature) {
      const img = new Image();
      img.onload = function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);
      };
      img.src = data.signature;
    }

    // Restore map marks
const container = document.getElementById('damageMapContainer');

// smaž jen existující body (div marky)
container.querySelectorAll('div').forEach(el => el.remove());

if (data.mapMarks) {
  data.mapMarks.forEach(markData => {
    const mark = document.createElement('div');
    mark.innerText = markData.text;
    mark.style.position = 'absolute';
    mark.style.left = markData.left;
    mark.style.top = markData.top;
    mark.style.transform = 'translate(-50%, -50%)';
    mark.style.background = 'red';
    mark.style.color = 'white';
    mark.style.borderRadius = '50%';
    mark.style.width = '22px';
    mark.style.height = '22px';
    mark.style.display = 'flex';
    mark.style.alignItems = 'center';
    mark.style.justifyContent = 'center';
    mark.style.fontSize = '12px';
    mark.style.fontWeight = 'bold';

    container.appendChild(mark);
  });
}
Sent
Write to Daniela Puskarova
  };

  reader.readAsText(file);
}</script>

</body>
</html>
